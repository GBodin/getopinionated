{% extends "base.html" %}
{% load filters %}
{% load macros %}
{% loadmacros "proposal/tag-list-macro.html" %}
{% loadmacros "proposal/proposal-list-macro.html" %}
{% load thumbnail %}
{% load humanize %}

{% block title %}{% include "title.html" with subtitle=member.display_name subtitle2="'s profile" %}{% endblock %}

{% block extrastyle %}
    <link rel="stylesheet" href="{{STATIC_URL}}css/profile.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="{{STATIC_URL}}css/proxy.css" type="text/css" charset="utf-8" />
    {% if proxyform %}
    	{{ proxyform.media }}
    {% endif %}
{% endblock %}

{% block content %}
	<div class="profile">
		<h1>{{member.display_name}}</h1>
		<div class="profile-header">
			<div class="gravatar">
				{% thumbnail member.avatar "128x128" crop="center" as im %}
					<div class="profile-picture">
				    	<img src="{{ im.url }}">
				    </div>
			    {% empty %}
				{% endthumbnail %}
				<div class="karma">
					<span>{{member.karma}}</span>
					karma
				</div>
			</div>
			<div class="table">
				<table>
					<tbody>
						<tr>
							<th>visits</th>
							<td>member for</td>
							<td>{{member.member_since|timesince}}</td>
						</tr>
						<tr>
							<th></th>
							<td>last login</td>
							<td>{{member.last_login|timesince}}</td>
						</tr>
					</tbody>
					<tbody>
						<tr>
							<th>Stats</th>
							<td>Profile views</td>
							<td>{{member.profile_views}}</td>
						</tr>
				</table>
			</div>
			{% if proxyform %}
				<form action="{{ request.build_absolute_uri }}" method="POST" class="profileproxyform">
					{% csrf_token %}
					I proxy my votes to {{member.display_name}} for the tags:<br /> 
					{{proxyform.profile_proxy_tags}}
					<input type="submit" id="submitButton" value="Save your proxies" />
				</form>
			{% endif %}
		</div>
			
        
            
		{% block data %}
            
            
            {% if tag_list %}
                <div class="profile-tag-list">
                    <h1>{{member.display_name}}'s tags</h1>
                </div>
                {% usemacro tag-list-macro tag_list %}
                <a href="{% url user-tags member.slug %}">See all tags</a>
            {% else %}
            {% endif %}
            
            
		    {% if proposal_list %}
		    	<div class="profile-proposal-list">
			    	<h1>{{member.display_name}}'s proposals</h1>
			        {% usemacro proposal-list-macro proposal_list %}
			        <a href="{% url user-proposals member.slug %}">See all proposals</a>
		        </div>
		    {% else %}
		    {% endif %}
		    
		
			{% if pos_comment_list or neutr_comment_list or neg_comment_list %}
				<div class="profile-comment-list">
			    	<h1>{{member.display_name}}'s comments</h1>
			    	<div class="positive">
			    		<h2>Positive</h2>
				    	<table class="comment-list">
					    	{% for comment in pos_comment_list %}
					        	<tr>
					        		<th>{{comment.upvote_score}}<p class="tiny-text">upvote</p></th>
					        		<td><a href="{% url proposals-detail comment.proposal.slug %}">{{comment.proposal.title}}</a></td>
					        	</tr>
					        {% endfor %}
				        </table>
				    </div>
				    <div class="neutral">
				    	<h2>Neutral</h2>
				    	<table class="comment-list">
					    	{% for comment in neutr_comment_list %}
					    	    <tr>
					        		<th>{{comment.upvote_score}}<p class="tiny-text">upvote</p></th>					        		
				        		    <td><a href="{% url proposals-detail comment.proposal.slug %}">{{comment.proposal.title}}</a></td>
					        	</tr>
					        {% endfor %}
				        </table>
				    </div>
				    <div class="negative">
				    	<h2>Negative</h2>
				    	<table class="comment-list">
					    	{% for comment in neg_comment_list %}
						    	<a href="{% url proposals-detail comment.proposal.slug %}">
						        	<tr>
						        		<th>{{comment.upvote_score}}<p class="tiny-text">upvote</p></th>
						        		<td><a href="{% url proposals-detail comment.proposal.slug %}">{{comment.proposal.title}}</a></td>
						        	</tr>
						        </a>
					        {% endfor %}
				        </table>
				    </div>		     
		        </div>
		        <a href="{% url user-comments member.slug %}">See all comments</a>
		    {% else %}
		    {% endif %}
		    
		
			{% if pos_vote_list or neutr_vote_list or neg_vote_list %}
				<div class="profile-vote-list">
			    	<h1>{{member.display_name}}'s votes</h1>
			    	<div class="positive">
			    		<h2>Positive</h2>
				    	<table class="vote-list">
					    	{% for vote in pos_vote_list %}
					        	<tr>
					        		<th>{{vote.value|floatformat}}<p class="tiny-text">voted</p></th>
					        		<th>{{vote.numvotes}}<p class="tiny-text">votes</p></th>
					        		<td><a href="{% url proposals-detail vote.proposal.slug %}">{{vote.proposal.title}}</a></td>
					        	</tr>
					        {% endfor %}
				        </table>
				    </div>
				    <div class="neutral">
				    	<h2>Neutral</h2>
				    	<table class="vote-list">
					    	{% for vote in neutr_vote_list %}
					        	<tr>
					        		<th>{{vote.value|floatformat}}<p class="tiny-text">voted</p></th>
					        		<th>{{vote.numvotes}}<p class="tiny-text">votes</p></th>
					        		<td><a href="{% url proposals-detail vote.proposal.slug %}">{{vote.proposal.title}}</a></td>
					        	</tr>
					        {% endfor %}
				        </table>
				    </div>
				    <div class="negative">
				    	<h2>Negative</h2>
				    	<table class="vote-list">
					    	{% for vote in neg_vote_list %}
					        	<tr>
					        		<th>{{vote.value|floatformat}}<p class="tiny-text">voted</p></th>
					        		<th>{{vote.numvotes}}<p class="tiny-text">votes</p></th>
					        		<td><a href="{% url proposals-detail vote.proposal.slug %}">{{vote.proposal.title}}</a></td>
                                </tr>
					        {% endfor %}
				        </table>
				    </div>		     
		        </div>
		        <a href="{% url user-votes member.slug %}">See all votes</a>
		    {% else %}
		    {% endif %}
		
		    
			{% if pos_proxy_vote_list or neutr_proxy_vote_list or neg_proxy_vote_list %}
                <div class="profile-vote-list">
                    <h1>{{member.display_name}}'s votes through proxies</h1>
                    <div class="positive">
                        <h2>Positive</h2>
                        <table class="vote-list">
                            {% for vote in pos_proxy_vote_list %}
                                <tr>
                                    <th>{{vote.value}}<p class="tiny-text">voted</p></th>
                                    <th>{{vote.numvotes}}<p class="tiny-text">votes</p></th>
                                    <td><a href="{% url proposals-detail vote.proposal.slug %}">{{vote.proposal.title}}</a></td>
                                </tr>
                            {% endfor %}
                        </table>
                    </div>
                    <div class="neutral">
                        <h2>Neutral</h2>
                        <table class="vote-list">
                            {% for vote in neutr_proxy_vote_list %}
                                <tr>
                                    <th>{{vote.value}}<p class="tiny-text">voted</p></th>
                                    <th>{{vote.numvotes}}<p class="tiny-text">votes</p></th>
                                    <td><a href="{% url proposals-detail vote.proposal.slug %}">{{vote.proposal.title}}</a></td>
                                </tr>
                            {% endfor %}
                        </table>
                    </div>
                    <div class="negative">
                        <h2>Negative</h2>
                        <table class="vote-list">
                            {% for vote in neg_proxy_vote_list %}
                                <tr>
                                    <th>{{vote.value}}<p class="tiny-text">voted</p></th>
                                    <th>{{vote.numvotes}}<p class="tiny-text">votes</p></th>
                                    <td><a href="{% url proposals-detail vote.proposal.slug %}">{{vote.proposal.title}}</a></td>
                                </tr>
                            {% endfor %}
                        </table>
                    </div>           
                </div>
                <a href="{% url user-votes member.slug %}">See all votes</a>
            {% else %}
            {% endif %}
		{% endblock %}
	</div>
{% endblock %}
