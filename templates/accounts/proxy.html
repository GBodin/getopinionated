{% extends "base.html" %}
{% load filters %}
{% load macros %}
{% loadmacros "accounts/member-macro.html" %}
{% loadmacros "proposal/tag-macro.html" %}

{% block title %}{% include "title.html" with subtitle="Proposals" %}{% endblock %}


{% block extrastyle %}
	<link rel="stylesheet" href="{{STATIC_URL}}css/proxy.css" type="text/css" charset="utf-8" />
	<script type="text/javascript" src="{{STATIC_URL}}js/proxy.js"></script>
	<script type="text/javascript" src="{{STATIC_URL}}js/springy/springy.js"></script>
	<script type="text/javascript" src="{{STATIC_URL}}js/springy/springyui.js"></script>
	{{ proxyform.media }}
	<script type="application/javascript">
		jQuery(function(){
			var graph = new Springy.Graph();
			var graphJSON = {{proxygraph.nodesToJson|safe}};

			graph.loadJSON(graphJSON);
			graph.addEdges({{proxygraph.edgesToArgs|safe}});

			var springy = jQuery('#springyproxy').springy({
				graph: graph
			});
		});
	</script>
{% endblock %}

{% block content %}
<div>
	<form action="{% if filter_tag %}{% url proxy-index filter_tag.slug %}{% else %}{% url proxy-index %}{% endif %}" method="POST" class="proxyform">
	{% csrf_token %}
	<div>
		My vote for everything goes to {{ proxyform.main_proxy }}
	</div>
	<div class="proxy_list">
		<div id ="itemhidden" class="proxy_item" style="display:none">
			I delegate my vote for the tags {{ proxyform.side_proxy_tags }} to {{ proxyform.side_proxy }}
		</div>
		{% for userfield, tagfield in proxyform.getDefaultFieldList %}
			<div id="item{{ forloop.counter0 }}" class="proxy_item">
				I delegate my vote for the tags {{ tagfield }} to {{ userfield }}
			</div>
		{% endfor%}
	</div>
	<input type="number" id="tagfieldcount" name="tagfieldcount" value="{{ proxyform.getDefaultFieldList|length }}"  style="display:none" />
	<input type="button" id="addProxyButton" value="Add another proxy" />
	<input type="submit" id="submitButton" value="Save your proxies" />
	</form>
</div>
<div>
	<h2>
		Current proxy landscape
		{% if filter_tag %}
			for <div class="tag-button">{{ filter_tag.name }}</div>
		{% endif %}
	</h2>
	<canvas id="springyproxy" width="1024" height="600"></canvas>
	<div>
		Filter on 
		{% for tag in tags %}
			{% if filter_tag and filter_tag.slug == tag.slug %}
				<div class="tag-button" style="background-color: #333">{{ tag.name }}</div>
			{% else %}
				<a href="{% url proxy-index tag.slug %}"><div class="tag-button">{{ tag.name }}</div></a>
			{% endif %}
		{% endfor %}
		{% if filter_tag %}
			<a href="{% url proxy-index %}"><div class="tag-button">No filter</div></a>
		{% else %}
			<div class="tag-button" style="background-color: #333">No filter</div>
		{% endif %}
	</div>
</div>
 {% endblock %}